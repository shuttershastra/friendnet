<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="friendnet">
    <Require feature="opensocial-0.7"/>
  </ModulePrefs>
  <Content type="html">
    <![CDATA[
     
      <script>
        gadgets.util.registerOnLoadHandler(init);
      </script>
      <script>
      	function init() { 
			alert('init'); 
		}
			      
		function swf_ready() {
		  alert('SWF ready');
		  loadFriends();
		}
      
      	function test() {
        	alert('test');
        	var app = getSWF('EISample');
		  	if (!app) output('app missing');
		  	else {
		    	app.add_friends('loading ...');
		  	} 
		}
		
		function getSWF(movieName) { 
		  var isIE = navigator.appName.indexOf("Microsoft") != -1; 
		  return (isIE) ? window[movieName] : document[movieName];
		} 
		
		function loadFriends() {
		  alert('loadFriends');
		  var req = opensocial.newDataRequest();
		
		  req.add(req.newFetchPersonRequest('OWNER'), 'viewer');
		
		  var opt_params = {};
		  opt_params[opensocial.DataRequest.PeopleRequestFields.MAX] = 100; 
		
		  req.add(req.newFetchPeopleRequest('OWNER_FRIENDS', opt_params), 'viewerFriends');
		  req.send(onLoadFriends);
		}
		
		function onLoadFriends(data) {
		alert('onLoadFriends');
		  alert(data.get("viewer").getData());
		
		  var viewer = data.get('viewer').getData();
		  var count=indata.getTotalSize(); 
		  var viewerFriends = data.get('viewerFriends').getData();
		  
		  html = new Array();
		  html.push('<ul>');
		  viewerFriends.each(function(person) {
		    html.push('<li>' + person.getDisplayName() + "</li>");    
		  });
		  html.push('</ul>');
		  document.getElementById('friends').innerHTML = html.join('');
		  //document.getElementById('fcount').innerHTML = '' + count;
		  //document.getElementById('me').innerHTML = viewer.getDisplayName();
		  //gadgets.window.adjustHeight();
		}
	  </script>
      <div id='main'>
      <div id='app'>

      <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
			id="EISample" width="482" height="348"
			codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">
			<param name="movie" value="http://megaswf.com/upload_files/5c1eef220a4ce10dae722e361e8b73fb.swf" />
			<param name="quality" value="high" />
			<param name="bgcolor" value="#869ca7" />
			<param name="allowScriptAccess" value="always" />
			<embed src="http://megaswf.com/upload_files/5c1eef220a4ce10dae722e361e8b73fb.swf" quality="high" bgcolor="#869ca7"
				width="482" height="348" name="EISample" align="middle"
				play="true"
				loop="false"
				quality="high"
				allowScriptAccess="always"
				type="application/x-shockwave-flash"
				pluginspage="http://www.adobe.com/go/getflashplayer">
			</embed>
	</object>
  <div>
  <form id='gift_form'>
            Add friends to above display list: <a href='javascript:void(0);' onclick='test();'>Go!</a>
    </form>
        Your friends:
        <div id='friends'></div>
      </div>
    ]]>
  </Content>
</Module>

